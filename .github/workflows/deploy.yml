name: Deploy to GitHub Pages
on:
  push:
    branches:
      - main
permissions:
  contents: write
  pages: write
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      
      - name: Create credentials.js file
        run: |
          # Create a separate credentials file with all the Firebase values
          cat > credentials.js << EOL
          // This file is generated by GitHub Actions - Do not edit manually
          window.firebaseCredentials = {
            apiKey: "${{ secrets.FIREBASE_API_KEY }}",
            authDomain: "${{ secrets.FIREBASE_AUTH_DOMAIN }}",
            projectId: "${{ secrets.FIREBASE_PROJECT_ID }}",
            storageBucket: "${{ secrets.FIREBASE_STORAGE_BUCKET }}",
            messagingSenderId: "${{ secrets.FIREBASE_MESSAGING_SENDER_ID }}",
            appId: "${{ secrets.FIREBASE_APP_ID }}"
          };
          
          window.powerBiUrl = "${{ secrets.POWER_BI_URL }}";
          EOL
          
          # Show file was created (without showing content)
          echo "credentials.js created ($(wc -c < credentials.js) bytes)"
          
      # Add a simple config.js that uses the credentials.js file
      - name: Create simplified config.js
        run: |
          cat > config.js << EOL
          // This file loads credentials from credentials.js
          const config = {
            powerBiUrl: window.powerBiUrl,
            firebase: window.firebaseCredentials
          };
          EOL
          
          echo "config.js created ($(wc -c < config.js) bytes)"
      
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./
          force_orphan: true
